<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ğŸ’ª 3ëŒ€ ìš´ë™ ê¸°ë¡ ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì¦ê°€ */
        @media (max-width: 480px) {
            html {
                font-size: 18px;
            }
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #0d0d0d;
            color: #ffffff;
            margin: 0;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
        }
        
        /* ëª¨ë°”ì¼ ìµœì í™” - ì—¬ë°± ìµœì†Œí™” */
        @media (max-width: 480px) {
            body {
                padding: 8px;
                font-size: 1rem; /* 18px ê¸°ì¤€ */
            }
        }
        
        /* íƒœë¸”ë¦¿ ë° í° í™”ë©´ */
        @media (min-width: 481px) {
            body {
                width: 420px;
                margin: 0 auto;
                padding: 20px;
            }
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block !important;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 0 5px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ í—¤ë” ê°„ê²© ì¡°ì • */
        @media (max-width: 480px) {
            .header {
                margin-bottom: 25px;
                padding: 0;
            }
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #ff4444;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë¡œê³  í¬ê¸° ëŒ€í­ ì¦ê°€ */
        @media (max-width: 480px) {
            .logo {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }
        }
        
        .card {
            background-color: #1f1f1f;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #333;
            width: 100%;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ì¹´ë“œ íŒ¨ë”© ì¦ê°€ */
        @media (max-width: 480px) {
            .card {
                padding: 20px 15px;
                margin-bottom: 20px;
                border-radius: 12px;
            }
        }
        
        .btn {
            width: 100%;
            padding: 16px 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 12px;
            background-color: #ff4444;
            color: white;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ í¬ê¸° ëŒ€í­ ì¦ê°€ */
        @media (max-width: 480px) {
            .btn {
                padding: 22px 15px;
                font-size: 1.3rem;
                min-height: 65px;
                margin-bottom: 18px;
                border-radius: 12px;
            }
        }
        
        .btn:hover {
            background-color: #ff6666;
        }
        
        .btn-secondary {
            background-color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #555;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 12px;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: #000;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 12px;
            box-sizing: border-box;
            min-height: 50px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ í•„ë“œ í¬ê¸° ëŒ€í­ ì¦ê°€ */
        @media (max-width: 480px) {
            .form-input {
                padding: 20px 15px;
                font-size: 1.2rem;
                min-height: 65px;
                margin-bottom: 18px;
                border-radius: 12px;
                border-width: 3px;
            }
        }
        
        .form-input:focus {
            outline: none;
            border-color: #00ff88;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #00ff88;
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë¼ë²¨ í¬ê¸° ì¦ê°€ */
        @media (max-width: 480px) {
            .form-label {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }
        }
        
        .radio-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ê·¸ë£¹ ê°„ê²© ì¦ê°€ */
        @media (max-width: 480px) {
            .radio-group {
                gap: 12px;
                margin-bottom: 20px;
            }
        }
        
        .radio-item {
            flex: 1;
        }
        
        .radio-item input {
            display: none;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            text-align: center;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: #000;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            min-height: 50px;
            touch-action: manipulation;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë¼ë””ì˜¤ ë¼ë²¨ í¬ê¸° ëŒ€í­ ì¦ê°€ */
        @media (max-width: 480px) {
            .radio-label {
                padding: 20px 8px;
                font-size: 1.1rem;
                min-height: 65px;
                border-radius: 12px;
                border-width: 3px;
                line-height: 1.2;
            }
        }
        
        .radio-item input:checked + .radio-label {
            border-color: #00ff88;
            background-color: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .link {
            color: #00ff88;
            text-decoration: none;
            font-weight: bold;
        }
        
        .text-center {
            text-align: center;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .alert-error {
            background-color: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            border: 1px solid #ff4444;
        }
        
        .alert-success {
            background-color: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #333;
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .back-btn {
            display: inline-block;
            color: #00ff88;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .exercise-section {
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }
        
        .exercise-section:last-child {
            border-bottom: none;
        }
        
        .exercise-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
            text-align: center;
            margin-bottom: 15px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ìš´ë™ ì œëª© í¬ê¸° ì¡°ì • */
        @media (max-width: 480px) {
            .exercise-title {
                font-size: 1.6rem;
                margin-bottom: 18px;
            }
        }
        
        .weight-input-group {
            display: flex;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
        }
        
        .weight-input {
            flex: 1;
        }
        
        .weight-input .form-input {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            min-height: 55px;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ì¤‘ëŸ‰ ì…ë ¥ í•„ë“œ í¬ê¸° ëŒ€í­ ì¦ê°€ */
        @media (max-width: 480px) {
            .weight-input .form-input {
                font-size: 1.8rem;
                min-height: 70px;
                padding: 22px 15px;
                border-radius: 12px;
            }
        }
        
        .kg-label {
            color: #ccc;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1rem;
            white-space: nowrap;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ KG ë¼ë²¨ í¬ê¸° ì¦ê°€ */
        @media (max-width: 480px) {
            .kg-label {
                font-size: 1.4rem;
                margin-bottom: 18px;
            }
        }
        
        .result-card {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(0, 255, 136, 0.1));
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .result-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .result-total {
            font-size: 3rem;
            font-weight: bold;
            color: #ff4444;
            margin: 20px 0;
        }
        
        .result-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .result-item {
            text-align: center;
            padding: 15px 8px;
            background-color: rgba(0,0,0,0.4);
            border-radius: 8px;
        }
        
        .result-item-label {
            color: #ccc;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .result-item-value {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .success {
            color: #00ff88;
        }
        
        .failure {
            color: #ff4444;
        }

        .my-rank-card {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(255, 68, 68, 0.1));
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .filter-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .filter-tab.active {
            background-color: #00ff88;
            color: #000;
        }

        .filter-tab:hover {
            background-color: rgba(0, 255, 136, 0.2);
        }

        .rank-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            background-color: rgba(0,0,0,0.4);
            border: 1px solid #333;
        }

        .rank-number {
            font-size: 1.5rem;
            font-weight: bold;
            width: 50px;
            text-align: center;
        }

        .rank-gold { color: #FFD700; }
        .rank-silver { color: #C0C0C0; }
        .rank-bronze { color: #CD7F32; }
        .rank-normal { color: #ccc; }

        .user-info {
            flex: 1;
            margin-left: 15px;
        }

        .user-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #fff;
        }

        .user-details {
            font-size: 0.8rem;
            color: #888;
        }

        .user-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff4444;
            text-align: right;
        }

      /* ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

/* í™”ë©´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
.screen {
    animation: fadeIn 0.3s ease-out;
}

/* ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
.card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0, 255, 136, 0.1);
}

/* ë²„íŠ¼ ê°œì„  */
.btn {
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.btn:active::before {
    width: 300px;
    height: 300px;
}

/* ë­í‚¹ ì•„ì´í…œ ì• ë‹ˆë©”ì´ì…˜ */
.rank-item {
    animation: slideIn 0.4s ease-out;
    animation-fill-mode: both;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.rank-item:hover {
    transform: translateX(5px);
    box-shadow: -5px 0 20px rgba(0, 255, 136, 0.1);
}

/* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background-color: #00ff88;
    color: #000;
    padding: 15px 25px;
    border-radius: 25px;
    font-weight: bold;
    z-index: 1000;
    transition: transform 0.3s ease;
    box-shadow: 0 5px 20px rgba(0, 255, 136, 0.3);
}

.toast.show {
    transform: translateX(-50%) translateY(0);
}
    </style>
</head>
<body>
    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="screen active">
        <div class="container">
            <div class="header">
                <div class="logo">ğŸ’ª 3ëŒ€ ìš´ë™ ê¸°ë¡ ê´€ë¦¬</div>
                <p>íŒŒì›Œë¥¼ ì¸¡ì •í•˜ê³  ê¸°ë¡í•˜ì„¸ìš”</p>
            </div>
            
            <div class="card">
                <div class="text-center" style="margin-bottom: 20px;">
                    <h2 style="color: #00ff88; margin-bottom: 15px;">ğŸ’¯ ì² ì˜ ì „ì‚¬ê°€ ë˜ì–´ë³´ì„¸ìš”</h2>
                    <p style="color: #ccc;">ìŠ¤ì¿¼íŠ¸, ë²¤ì¹˜í”„ë ˆìŠ¤, ë°ë“œë¦¬í”„íŠ¸<br>ë‹¹ì‹ ì˜ í•œê³„ë¥¼ ë›°ì–´ë„˜ì–´ ë³´ì„¸ìš”!</p>
                </div>
                
                <button class="btn" onclick="goToLogin()">ë¡œê·¸ì¸</button>
                <button class="btn btn-secondary" onclick="goToRegister()">íšŒì›ê°€ì…</button>
            </div>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="screen">
        <div class="container">
            <div class="header">
                <div class="logo">ğŸ” ë¡œê·¸ì¸</div>
            </div>
            
            <div class="card">
                <div id="loginAlert"></div>
                
                <form onsubmit="return doLogin(event)">
                    <label class="form-label">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="tel" class="form-input" id="loginPhone" placeholder="010-0000-0000" required>
                    
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
                    
                    <button type="submit" class="btn">
                        <span id="loginBtnText">ë¡œê·¸ì¸</span>
                        <span id="loginBtnLoading" class="loading hidden"></span>
                    </button>
                </form>
                
                <div class="text-center">
                    <a href="#" class="link" onclick="goToRegister()">íšŒì›ê°€ì…</a> | 
                    <a href="#" class="link" onclick="doResetPassword()">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                </div>
                
                <div class="text-center" style="margin-top: 20px;">
                    <a href="#" class="link" onclick="goToStart()">â† ëŒì•„ê°€ê¸°</a>
                </div>
            </div>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… í™”ë©´ -->
    <div id="registerScreen" class="screen">
        <div class="container">
            <div class="header">
                <div class="logo">ğŸ“ íšŒì›ê°€ì…</div>
            </div>
            
            <div class="card">
                <div id="registerAlert"></div>
                
                <form onsubmit="return doRegister(event)">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="registerName" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
                    
                    <label class="form-label">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="tel" class="form-input" id="registerPhone" placeholder="010-0000-0000" required>
                    
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="ìµœì†Œ 4ìë¦¬" required>
                    
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" class="form-input" id="registerPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" required>
                    
                    <label class="form-label">ì„±ë³„</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="male" name="gender" value="ë‚¨" required>
                            <label for="male" class="radio-label">ğŸ‘¨ ë‚¨ì„±</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="female" name="gender" value="ì—¬" required>
                            <label for="female" class="radio-label">ğŸ‘© ì—¬ì„±</label>
                        </div>
                    </div>
                    
                    <label class="form-label">ë‹´ë‹¹ íŠ¸ë ˆì´ë„ˆ</label>
                    <input type="text" class="form-input" id="registerTrainer" placeholder="íŠ¸ë ˆì´ë„ˆ ì´ë¦„" required>
                    
                    <button type="submit" class="btn">
                        <span id="registerBtnText">íšŒì›ê°€ì… ì™„ë£Œ</span>
                        <span id="registerBtnLoading" class="loading hidden"></span>
                    </button>
                </form>
                
                <div class="text-center">
                    <a href="#" class="link" onclick="goToLogin()">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
                </div>
                
                <div class="text-center" style="margin-top: 20px;">
                    <a href="#" class="link" onclick="goToStart()">â† ëŒì•„ê°€ê¸°</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen" class="screen">
        <div class="container">
            <div class="card">
                <div class="text-center">
                    <h2 style="color: #00ff88;" id="welcomeMessage">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                    <p id="userInfo" style="color: #ccc; margin-top: 10px;"></p>
                </div>
                
                <button class="btn" onclick="goToRecordType()">ğŸ“ ìƒˆ ê¸°ë¡ ë“±ë¡</button>
                <button class="btn btn-secondary" onclick="goToHistory()">ğŸ“Š ë‚´ ê¸°ë¡ íˆìŠ¤í† ë¦¬</button>
                <button class="btn btn-secondary" onclick="goToRankings()">ğŸ† ì „ì²´ ìˆœìœ„ ë³´ê¸°</button>
                
                <div class="text-center" style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="doLogout()" style="width: auto; padding: 10px 20px;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê¸°ë¡ ìœ í˜• ì„ íƒ í™”ë©´ -->
    <div id="recordTypeScreen" class="screen">
        <div class="container">
            <a href="#" class="back-btn" onclick="goToMain()">â† ë©”ì¸ìœ¼ë¡œ</a>
            
            <div class="header">
                <div class="logo">ğŸ“‹ ê¸°ë¡ ìœ í˜• ì„ íƒ</div>
                <p style="color: #ccc;">ì›í•˜ëŠ” ê¸°ë¡ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</p>
            </div>
            
            <div class="card">
                <label class="form-label">ê¸°ë¡ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="workout" name="recordType" value="ìš´ë™ê¸°ë¡" required>
                        <label for="workout" class="radio-label">
                            ğŸ‹ï¸<br>ìš´ë™ê¸°ë¡<br>
                            <small style="font-size: 0.8rem; opacity: 0.7;">ê° ìš´ë™ë³„ 1íšŒ ì‹œë„</small>
                        </label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="competition" name="recordType" value="ëŒ€íšŒê¸°ë¡" required>
                        <label for="competition" class="radio-label">
                            ğŸ†<br>ëŒ€íšŒê¸°ë¡<br>
                            <small style="font-size: 0.8rem; opacity: 0.7;">ê° ìš´ë™ë³„ 1íšŒ ì‹œë„</small>
                        </label>
                    </div>
                </div>
                
                <button class="btn" onclick="startRecording()">ë‹¤ìŒ ë‹¨ê³„</button>
                
                <div style="margin-top: 20px; padding: 15px; background-color: rgba(0,255,136,0.1); border-radius: 8px; font-size: 0.9rem;">
                    <strong>ğŸ’¡ ì°¸ê³ :</strong> ìš´ë™ê¸°ë¡ê³¼ ëŒ€íšŒê¸°ë¡ ëª¨ë‘ ê° ìš´ë™ë³„ë¡œ 1íšŒì”©ë§Œ ì‹œë„í•©ë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <!-- ìš´ë™ ê¸°ë¡ ì…ë ¥ í™”ë©´ -->
    <div id="recordInputScreen" class="screen">
        <div class="container">
            <a href="#" class="back-btn" onclick="goToRecordType()">â† ì´ì „ìœ¼ë¡œ</a>
            
            <div class="header">
                <div class="logo">ğŸ’ª ìš´ë™ ê¸°ë¡ ì…ë ¥</div>
                <p id="recordTypeTitle" style="color: #ccc;">ìš´ë™ê¸°ë¡</p>
            </div>
            
            <div class="card">
                <form onsubmit="return doSubmitRecord(event)">
                    <!-- ìŠ¤ì¿¼íŠ¸ -->
                    <div class="exercise-section">
                        <div class="exercise-title">ğŸ¦µ ìŠ¤ì¿¼íŠ¸</div>
                        <div class="weight-input-group">
                            <div class="weight-input">
                                <label class="form-label">ì¤‘ëŸ‰</label>
                                <input type="number" class="form-input" id="squatWeight" placeholder="0" min="0" step="0.5" required>
                            </div>
                            <div class="kg-label">KG</div>
                        </div>
                        <label class="form-label">ì„±ê³µ ì—¬ë¶€</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="squatSuccess" name="squatResult" value="ì„±ê³µ">
                                <label for="squatSuccess" class="radio-label">âœ… ì„±ê³µ</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="squatFail" name="squatResult" value="ì‹¤íŒ¨">
                                <label for="squatFail" class="radio-label">âŒ ì‹¤íŒ¨</label>
                            </div>
                        </div>
                    </div>

                    <!-- ë²¤ì¹˜í”„ë ˆìŠ¤ -->
                    <div class="exercise-section">
                        <div class="exercise-title">ğŸ’ª ë²¤ì¹˜í”„ë ˆìŠ¤</div>
                        <div class="weight-input-group">
                            <div class="weight-input">
                                <label class="form-label">ì¤‘ëŸ‰</label>
                                <input type="number" class="form-input" id="benchWeight" placeholder="0" min="0" step="0.5" required>
                            </div>
                            <div class="kg-label">KG</div>
                        </div>
                        <label class="form-label">ì„±ê³µ ì—¬ë¶€</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="benchSuccess" name="benchResult" value="ì„±ê³µ">
                                <label for="benchSuccess" class="radio-label">âœ… ì„±ê³µ</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="benchFail" name="benchResult" value="ì‹¤íŒ¨">
                                <label for="benchFail" class="radio-label">âŒ ì‹¤íŒ¨</label>
                            </div>
                        </div>
                    </div>

                    <!-- ë°ë“œë¦¬í”„íŠ¸ -->
                    <div class="exercise-section">
                        <div class="exercise-title">ğŸ”¥ ë°ë“œë¦¬í”„íŠ¸</div>
                        <div class="weight-input-group">
                            <div class="weight-input">
                                <label class="form-label">ì¤‘ëŸ‰</label>
                                <input type="number" class="form-input" id="deadWeight" placeholder="0" min="0" step="0.5" required>
                            </div>
                            <div class="kg-label">KG</div>
                        </div>
                        <label class="form-label">ì„±ê³µ ì—¬ë¶€</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="deadSuccess" name="deadResult" value="ì„±ê³µ">
                                <label for="deadSuccess" class="radio-label">âœ… ì„±ê³µ</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="deadFail" name="deadResult" value="ì‹¤íŒ¨">
                                <label for="deadFail" class="radio-label">âŒ ì‹¤íŒ¨</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn">
                        <span id="submitBtnText">ğŸ”¥ ê¸°ë¡ ì œì¶œ</span>
                        <span id="submitBtnLoading" class="loading hidden"></span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="resultScreen" class="screen">
        <div class="container">
            <div class="result-card">
                <div class="result-title">ğŸ‰ ê¸°ë¡ ì™„ë£Œ!</div>
                <div class="result-total" id="resultTotal">0 KG</div>
                
                <div class="result-details">
                    <div class="result-item">
                        <div class="result-item-label">ìŠ¤ì¿¼íŠ¸</div>
                        <div class="result-item-value" id="resultSquat">0kg</div>
                    </div>
                    <div class="result-item">
                        <div class="result-item-label">ë²¤ì¹˜</div>
                        <div class="result-item-value" id="resultBench">0kg</div>
                    </div>
                    <div class="result-item">
                        <div class="result-item-label">ë°ë“œ</div>
                        <div class="result-item-value" id="resultDead">0kg</div>
                    </div>
                </div>
                
                <div style="font-size: 1.1rem; color: #00ff88; font-weight: bold;" id="resultRank">ì „ì²´ ìˆœìœ„: ê³„ì‚°ì¤‘...</div>
            </div>
            
            <div class="card">
                <h3 style="color: #00ff88; margin-bottom: 20px; text-align: center;">ğŸ¤– AI í”¼ë“œë°±</h3>
                <div id="aiFeedback" style="line-height: 1.6;">
                    <div class="text-center" style="padding: 20px 0;">
                        <div class="loading"></div>
                        <div style="margin-top: 10px; color: #ccc;">AIê°€ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
                
                <!-- AI í”¼ë“œë°± ì„¹ì…˜ë“¤ -->
                <div id="feedbackSections" style="display: none;">
                    <!-- ì´í‰ -->
                    <div class="feedback-section" style="margin-bottom: 20px; padding: 15px; background-color: rgba(0,255,136,0.1); border-radius: 8px; border-left: 4px solid #00ff88;">
                        <h4 style="color: #00ff88; margin-bottom: 10px; font-size: 1rem;">ğŸ’¯ ì´í‰</h4>
                        <p id="feedbackSummary" style="margin: 0; color: #fff; font-size: 0.95rem; line-height: 1.5;"></p>
                    </div>
                    
                    <!-- ê°•ì  ë¶„ì„ -->
                    <div class="feedback-section" style="margin-bottom: 20px; padding: 15px; background-color: rgba(0,255,136,0.05); border-radius: 8px; border-left: 4px solid #00ff88;">
                        <h4 style="color: #00ff88; margin-bottom: 10px; font-size: 1rem;">ğŸ’ª ê°•ì </h4>
                        <p id="feedbackStrengths" style="margin: 0; color: #ccc; font-size: 0.9rem; line-height: 1.4;"></p>
                    </div>
                    
                    <!-- ê°œì„ ì  -->
                    <div class="feedback-section" style="margin-bottom: 20px; padding: 15px; background-color: rgba(255,68,68,0.05); border-radius: 8px; border-left: 4px solid #ff4444;">
                        <h4 style="color: #ff4444; margin-bottom: 10px; font-size: 1rem;">ğŸ¯ ê°œì„ ì </h4>
                        <p id="feedbackImprovements" style="margin: 0; color: #ccc; font-size: 0.9rem; line-height: 1.4;"></p>
                    </div>
                    
                    <!-- ë‹¤ìŒ ëª©í‘œ -->
                    <div class="feedback-section" style="margin-bottom: 15px; padding: 15px; background-color: rgba(255,136,0,0.05); border-radius: 8px; border-left: 4px solid #ff8800;">
                        <h4 style="color: #ff8800; margin-bottom: 10px; font-size: 1rem;">ğŸ¯ ë‹¤ìŒ ëª©í‘œ</h4>
                        <p id="feedbackGoals" style="margin: 0; color: #ccc; font-size: 0.9rem; line-height: 1.4;"></p>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button class="btn" onclick="shareResult()">ğŸ“¤ ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
                <button class="btn btn-secondary" onclick="goToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <!-- íˆìŠ¤í† ë¦¬ í™”ë©´ -->
    <div id="historyScreen" class="screen">
        <div class="container">
            <a href="#" class="back-btn" onclick="goToMain()">â† ë©”ì¸ìœ¼ë¡œ</a>
            
            <div class="header">
                <div class="logo">ğŸ“Š ë‚´ ê¸°ë¡ íˆìŠ¤í† ë¦¬</div>
                <p style="color: #ccc;">ë‚˜ì˜ ìš´ë™ ê¸°ë¡ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
            </div>
            
            <div id="historyContent">
                <div class="text-center" style="padding: 40px 0;">
                    <div class="loading"></div>
                    <div style="margin-top: 15px; color: #ccc;">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="rankingsScreen" class="screen">
        <div class="container">
            <a href="#" class="back-btn" onclick="goToMain()">â† ë©”ì¸ìœ¼ë¡œ</a>
            
            <div class="header">
                <div class="logo">ğŸ† ì „ì²´ ìˆœìœ„</div>
                <p style="color: #ccc;">íŒŒì›Œë¦¬í”„í„°ë“¤ì˜ ìˆœìœ„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</p>
            </div>
            
            <!-- ë‚´ ìˆœìœ„ ì¹´ë“œ -->
            <div class="my-rank-card" id="myRankCard" style="display: none;">
                <div style="color: #00ff88; font-weight: bold; margin-bottom: 10px;">ë‚´ í˜„ì¬ ìˆœìœ„</div>
                <div style="font-size: 2.5rem; font-weight: bold; color: #ff4444; margin: 10px 0;" id="myCurrentRank">-</div>
                <div style="color: #ccc;">
                    ê°œì¸ ìµœê³ : <span id="myBestTotal" style="color: #ff4444; font-weight: bold;">0kg</span>
                </div>
            </div>
            
            <!-- í†µê³„ ì •ë³´ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;" id="statsGrid">
                <div style="text-align: center; padding: 15px; background-color: rgba(0,0,0,0.4); border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #00ff88;" id="totalUsers">0</div>
                    <div style="font-size: 0.8rem; color: #ccc; margin-top: 5px;">ì´ ì‚¬ìš©ì</div>
                </div>
                <div style="text-align: center; padding: 15px; background-color: rgba(0,0,0,0.4); border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #00ff88;" id="avgTotal">0kg</div>
                    <div style="font-size: 0.8rem; color: #ccc; margin-top: 5px;">í‰ê·  ê¸°ë¡</div>
                </div>
            </div>
            
            <!-- í•„í„° íƒ­ -->
            <div style="display: flex; margin-bottom: 20px; background-color: rgba(0,0,0,0.4); border-radius: 8px; padding: 4px;">
             <button class="filter-tab active" onclick="filterRankings('all')">ì „ì²´</button>
             <button class="filter-tab" onclick="filterRankings('male')">ë‚¨ì„±</button>
            <button class="filter-tab" onclick="filterRankings('female')">ì—¬ì„±</button>
            </div>
            
            <!-- ê²€ìƒ‰ ë°•ìŠ¤ -->
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchInput" placeholder="ì‚¬ìš©ì ì´ë¦„ ê²€ìƒ‰..." onkeyup="searchRankings()" 
                       style="width: 100%; padding: 12px; border: 2px solid #333; border-radius: 8px; background-color: #000; color: #fff; font-size: 1rem;">
            </div>
            
            <!-- ìˆœìœ„ ëª©ë¡ -->
            <div id="rankingsContent">
                <div class="text-center" style="padding: 40px 0;">
                    <div class="loading"></div>
                    <div style="margin-top: 15px; color: #ccc;">ìˆœìœ„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var currentUser = null;
        var currentRecordType = null;
        
        // ì „ì²´ ìˆœìœ„ ê´€ë ¨ ë³€ìˆ˜
        var allRankings = [];
        var filteredRankings = [];
        var currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ì•± ì‹œì‘');
            setupPhoneFormat();
        });

        function showScreen(screenId) {
            console.log('í™”ë©´ ì „í™˜:', screenId);
            var screens = document.querySelectorAll('.screen');
            for (var i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            var targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                console.log('í™”ë©´ í‘œì‹œ ì„±ê³µ:', screenId);
            } else {
                console.error('í™”ë©´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', screenId);
            }
        }

        function goToStart() { showScreen('startScreen'); }
        function goToLogin() { showScreen('loginScreen'); }
        function goToRegister() { showScreen('registerScreen'); }
        function goToMain() { showScreen('mainScreen'); }
        function goToRecordType() { showScreen('recordTypeScreen'); }
        function goToRecordInput() { showScreen('recordInputScreen'); }
        function goToResult() { showScreen('resultScreen'); }
        function goToHistory() { showScreen('historyScreen'); loadUserHistory(); }

        function showAlert(containerId, message, type) {
            type = type || 'error';
            var container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '<div class="alert alert-' + type + '">' + message + '</div>';
                setTimeout(function() {
                    container.innerHTML = '';
                }, 5000);
            }
        }

        function toggleLoading(btnTextId, btnLoadingId, isLoading) {
            var textElement = document.getElementById(btnTextId);
            var loadingElement = document.getElementById(btnLoadingId);
            
            if (textElement) {
                textElement.style.display = isLoading ? 'none' : 'inline';
            }
            if (loadingElement) {
                loadingElement.style.display = isLoading ? 'inline-block' : 'none';
            }
        }

        function setupPhoneFormat() {
            var phoneInputs = ['loginPhone', 'registerPhone'];
            for (var i = 0; i < phoneInputs.length; i++) {
                var input = document.getElementById(phoneInputs[i]);
                if (input) {
                    input.addEventListener('input', function() {
                        formatPhone(this);
                    });
                }
            }
        }

        function formatPhone(input) {
            var value = input.value.replace(/[^0-9]/g, '');
            if (value.length >= 11) {
                input.value = value.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
            }
        }

        function doRegister(event) {
            event.preventDefault();
            
            var name = document.getElementById('registerName').value.trim();
            var phone = document.getElementById('registerPhone').value.trim();
            var password = document.getElementById('registerPassword').value;
            var passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            var genderElement = document.querySelector('input[name="gender"]:checked');
            var gender = genderElement ? genderElement.value : null;
            var trainer = document.getElementById('registerTrainer').value.trim();

            if (!name || !phone || !password || !gender || !trainer) {
                showAlert('registerAlert', 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }

            if (password !== passwordConfirm) {
                showAlert('registerAlert', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return false;
            }

            if (password.length < 4) {
                showAlert('registerAlert', 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }

            toggleLoading('registerBtnText', 'registerBtnLoading', true);

            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                toggleLoading('registerBtnText', 'registerBtnLoading', false);
                showAlert('registerAlert', 'Google Apps Script ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return false;
            }

            google.script.run
                .withSuccessHandler(function(result) {
                    toggleLoading('registerBtnText', 'registerBtnLoading', false);
                    
                    if (result && result.success) {
                        showAlert('registerAlert', result.message, 'success');
                        setTimeout(function() {
                            currentUser = result.userData;
                            updateUserInfo();
                            goToMain();
                        }, 1500);
                    } else {
                        showAlert('registerAlert', result ? result.message : 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    toggleLoading('registerBtnText', 'registerBtnLoading', false);
                    showAlert('registerAlert', 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
                })
                .registerUser({
                    name: name,
                    phone: phone,
                    password: password,
                    gender: gender,
                    trainer: trainer
                });

            return false;
        }

        function doLogin(event) {
            event.preventDefault();
            
            var phone = document.getElementById('loginPhone').value.trim();
            var password = document.getElementById('loginPassword').value;

            if (!phone || !password) {
                showAlert('loginAlert', 'íœ´ëŒ€í° ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }

            toggleLoading('loginBtnText', 'loginBtnLoading', true);

            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                toggleLoading('loginBtnText', 'loginBtnLoading', false);
                showAlert('loginAlert', 'Google Apps Script ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return false;
            }

            google.script.run
                .withSuccessHandler(function(result) {
                    toggleLoading('loginBtnText', 'loginBtnLoading', false);
                    
                    if (result && result.success) {
                        currentUser = result.userData;
                        updateUserInfo();
                        goToMain();
                    } else {
                        showAlert('loginAlert', result ? result.message : 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    toggleLoading('loginBtnText', 'loginBtnLoading', false);
                    showAlert('loginAlert', 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
                })
                .loginUser(phone, password);

            return false;
        }

        function doResetPassword() {
            var phone = prompt('ë“±ë¡ëœ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!phone) return;

            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                alert('Google Apps Script ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        alert(result.message);
                    } else {
                        alert(result ? result.message : 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                })
                .resetPassword(phone);
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('welcomeMessage').textContent = 'ì•ˆë…•í•˜ì„¸ìš”, ' + currentUser.name + 'ë‹˜!';
                document.getElementById('userInfo').textContent = 'íŠ¸ë ˆì´ë„ˆ: ' + currentUser.trainer + ' | ì„±ë³„: ' + currentUser.gender;
            }
        }

        function doLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                currentUser = null;
                goToStart();
            }
        }

        function startRecording() {
            var recordTypeElement = document.querySelector('input[name="recordType"]:checked');
            if (!recordTypeElement) {
                alert('ê¸°ë¡ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            currentRecordType = recordTypeElement.value;
            document.getElementById('recordTypeTitle').textContent = currentRecordType;
            console.log('ì„ íƒí•œ ê¸°ë¡ ìœ í˜•:', currentRecordType);
            
            goToRecordInput();
        }

        function doSubmitRecord(event) {
            event.preventDefault();

            // ì…ë ¥ê°’ ê²€ì¦
            var squatWeight = parseFloat(document.getElementById('squatWeight').value);
            var benchWeight = parseFloat(document.getElementById('benchWeight').value);
            var deadWeight = parseFloat(document.getElementById('deadWeight').value);
            
            // ì¤‘ëŸ‰ ê²€ì¦
            if (isNaN(squatWeight) || squatWeight < 0) {
                alert('ìŠ¤ì¿¼íŠ¸ ì¤‘ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('squatWeight').focus();
                return false;
            }
            
            if (isNaN(benchWeight) || benchWeight < 0) {
                alert('ë²¤ì¹˜í”„ë ˆìŠ¤ ì¤‘ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('benchWeight').focus();
                return false;
            }
            
            if (isNaN(deadWeight) || deadWeight < 0) {
                alert('ë°ë“œë¦¬í”„íŠ¸ ì¤‘ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('deadWeight').focus();
                return false;
            }
            
            var squatResultElement = document.querySelector('input[name="squatResult"]:checked');
            var benchResultElement = document.querySelector('input[name="benchResult"]:checked');
            var deadResultElement = document.querySelector('input[name="deadResult"]:checked');
            
            var squatResult = squatResultElement ? squatResultElement.value : null;
            var benchResult = benchResultElement ? benchResultElement.value : null;
            var deadResult = deadResultElement ? deadResultElement.value : null;

            // ì„±ê³µ/ì‹¤íŒ¨ ì„ íƒ ê²€ì¦
            if (!squatResult) {
                alert('ìŠ¤ì¿¼íŠ¸ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                document.querySelector('input[name="squatResult"]').focus();
                return false;
            }
            
            if (!benchResult) {
                alert('ë²¤ì¹˜í”„ë ˆìŠ¤ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                document.querySelector('input[name="benchResult"]').focus();
                return false;
            }
            
            if (!deadResult) {
                alert('ë°ë“œë¦¬í”„íŠ¸ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                document.querySelector('input[name="deadResult"]').focus();
                return false;
            }

            toggleLoading('submitBtnText', 'submitBtnLoading', true);

            var recordData = {
                userId: currentUser.id,
                recordType: currentRecordType,
                squatWeight: squatWeight,
                squatSuccess: squatResult,
                benchWeight: benchWeight,
                benchSuccess: benchResult,
                deadWeight: deadWeight,
                deadSuccess: deadResult
            };

            console.log('ê¸°ë¡ ì œì¶œ:', recordData);

            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                toggleLoading('submitBtnText', 'submitBtnLoading', false);
                alert('Google Apps Script ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return false;
            }

            google.script.run
                .withSuccessHandler(function(result) {
                    console.log('ê¸°ë¡ ì €ì¥ ì‘ë‹µ:', result);
                    toggleLoading('submitBtnText', 'submitBtnLoading', false);
                    if (result && result.success) {
                        displayResult(recordData, result);
                        goToResult();
                        generateAIFeedback(recordData, result);
                    } else {
                        alert('ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (result ? result.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', error);
                    toggleLoading('submitBtnText', 'submitBtnLoading', false);
                    alert('ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
                })
                .saveRecord(recordData);

            return false;
        }

        function displayResult(recordData, result) {
            document.getElementById('resultTotal').textContent = result.total + ' KG';
            document.getElementById('resultRank').textContent = 'ì „ì²´ ìˆœìœ„: ' + result.rank + 'ìœ„';
            
            document.getElementById('resultSquat').textContent = 
                recordData.squatSuccess === 'ì„±ê³µ' ? recordData.squatWeight + 'kg' : 'ì‹¤íŒ¨';
            document.getElementById('resultBench').textContent = 
                recordData.benchSuccess === 'ì„±ê³µ' ? recordData.benchWeight + 'kg' : 'ì‹¤íŒ¨';
            document.getElementById('resultDead').textContent = 
                recordData.deadSuccess === 'ì„±ê³µ' ? recordData.deadWeight + 'kg' : 'ì‹¤íŒ¨';

            var squatElement = document.getElementById('resultSquat');
            var benchElement = document.getElementById('resultBench');
            var deadElement = document.getElementById('resultDead');
            
            squatElement.className = 'result-item-value ' + (recordData.squatSuccess === 'ì„±ê³µ' ? 'success' : 'failure');
            benchElement.className = 'result-item-value ' + (recordData.benchSuccess === 'ì„±ê³µ' ? 'success' : 'failure');
            deadElement.className = 'result-item-value ' + (recordData.deadSuccess === 'ì„±ê³µ' ? 'success' : 'failure');
        }

        function generateAIFeedback(recordData, result) {
            document.getElementById('aiFeedback').innerHTML = 
                '<div class="text-center" style="padding: 20px 0;">' +
                '<div class="loading"></div>' +
                '<div style="margin-top: 10px; color: #ccc;">AIê°€ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...</div>' +
                '</div>';
            
            document.getElementById('feedbackSections').style.display = 'none';
            
            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                showSimpleFeedback(recordData, result);
                return;
            }

            google.script.run
                .withSuccessHandler(function(feedbackResult) {
                    if (feedbackResult && feedbackResult.feedback) {
                        parseAndDisplayFeedback(feedbackResult.feedback, recordData, result);
                    } else {
                        showSimpleFeedback(recordData, result);
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('AI í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜:', error);
                    showSimpleFeedback(recordData, result);
                })
                .generateAIFeedback(recordData, null, result.rank);
        }

        function showSimpleFeedback(recordData, result) {
            document.getElementById('aiFeedback').style.display = 'none';
            document.getElementById('feedbackSections').style.display = 'block';
            
            var total = result.total;
            var rank = result.rank;
            
            // ì„±ê³µí•œ ìš´ë™ ê°œìˆ˜ ê³„ì‚°
            var successCount = 0;
            if (recordData.squatSuccess === 'ì„±ê³µ') successCount++;
            if (recordData.benchSuccess === 'ì„±ê³µ') successCount++;
            if (recordData.deadSuccess === 'ì„±ê³µ') successCount++;
            
            // ë ˆë²¨ ê³„ì‚°
            var level = '';
            var levelColor = '';
            if (total >= 500) {
                level = 'ì—˜ë¦¬íŠ¸';
                levelColor = '#ff8800';
            } else if (total >= 350) {
                level = 'ê³ ê¸‰ì';
                levelColor = '#00ff88';
            } else if (total >= 200) {
                level = 'ì¤‘ê¸‰ì';
                levelColor = '#00ff88';
            } else {
                level = 'ì´ˆê¸‰ì';
                levelColor = '#ff4444';
            }
            
            // ìµœê³  ê¸°ë¡ ìš´ë™ ì°¾ê¸°
            var exercises = [
                { name: 'ìŠ¤ì¿¼íŠ¸', weight: recordData.squatWeight, success: recordData.squatSuccess },
                { name: 'ë²¤ì¹˜í”„ë ˆìŠ¤', weight: recordData.benchWeight, success: recordData.benchSuccess },
                { name: 'ë°ë“œë¦¬í”„íŠ¸', weight: recordData.deadWeight, success: recordData.deadSuccess }
            ];
            
            var successfulExercises = exercises.filter(function(ex) { return ex.success === 'ì„±ê³µ'; });
            var bestExercise = successfulExercises.length > 0 ? 
                successfulExercises.sort(function(a, b) { return b.weight - a.weight; })[0] : null;
            
            var failedExercises = exercises.filter(function(ex) { return ex.success === 'ì‹¤íŒ¨'; });
            
            // ì´í‰
            var summaryText = 'ğŸ”¥ ì´ <strong>' + total + 'kg</strong>ìœ¼ë¡œ ì „ì²´ <strong>' + rank + 'ìœ„</strong>ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ';
            summaryText += '<span style="color: ' + levelColor + '; font-weight: bold;">' + level + '</span> ìˆ˜ì¤€ì˜ ';
            if (successCount === 3) {
                summaryText += 'ì™„ë²½í•œ ê¸°ë¡ì…ë‹ˆë‹¤!';
            } else if (successCount === 2) {
                summaryText += 'ì•ˆì •ì ì¸ ê¸°ë¡ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.';
            } else {
                summaryText += 'ê¸°ë¡ì´ë©°, ë‹¤ìŒì—ëŠ” ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ê¸°ëŒ€í•´ë´…ë‹ˆë‹¤.';
            }
            
            document.getElementById('feedbackSummary').innerHTML = summaryText;
            
            // ê°•ì 
            var strengthsText = '';
            if (bestExercise) {
                strengthsText = 'íŠ¹íˆ ' + bestExercise.name + ' ' + bestExercise.weight + 'kgì´ ì¸ìƒì ì…ë‹ˆë‹¤! ';
                if (successCount === 3) {
                    strengthsText += 'ëª¨ë“  ìš´ë™ì„ ì„±ê³µì‹œí‚¨ ì™„ë²½í•œ ì»¨ë””ì…˜ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.';
                } else {
                    strengthsText += 'ê¾¸ì¤€í•œ í›ˆë ¨ì˜ ê²°ê³¼ê°€ ì˜ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.';
                }
            } else {
                strengthsText = 'ì´ë²ˆ ê¸°íšŒë¥¼ í†µí•´ í˜„ì¬ ìˆ˜ì¤€ì„ íŒŒì•…í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë„ì „ì—ì„œ ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ê¸°ëŒ€í•´ë´…ë‹ˆë‹¤.';
            }
            
            document.getElementById('feedbackStrengths').textContent = strengthsText;
            
            // ê°œì„ ì 
            var improvementsText = '';
            if (failedExercises.length > 0) {
                var weakestExercise = failedExercises[0].name;
                improvementsText = weakestExercise + ' ìš´ë™ì— ë” ì§‘ì¤‘ì ì¸ í›ˆë ¨ì´ í•„ìš”í•©ë‹ˆë‹¤. ';
                improvementsText += 'ê¸°ë³¸ ìì„¸ ì ê²€ê³¼ ì ì§„ì ì¸ ì¤‘ëŸ‰ ì¦ê°€ë¥¼ í†µí•´ ê°œì„ í•´ë³´ì„¸ìš”.';
            } else {
                improvementsText = 'ëª¨ë“  ìš´ë™ì„ ì„±ê³µí–ˆì§€ë§Œ, ì§€ì†ì ì¸ ë°œì „ì„ ìœ„í•´ ìš´ë™ë³„ ë°¸ëŸ°ìŠ¤ë¥¼ ìœ ì§€í•˜ë©° ì ì§„ì ìœ¼ë¡œ ì¤‘ëŸ‰ì„ ì¦ê°€ì‹œì¼œë³´ì„¸ìš”.';
            }
            
            document.getElementById('feedbackImprovements').textContent = improvementsText;
            
            // ë‹¤ìŒ ëª©í‘œ
            var nextGoal = Math.ceil(total / 25) * 25 + 25;
            var goalsText = 'ë‹¤ìŒ ëª©í‘œëŠ” ì´í•© ' + nextGoal + 'kg ë‹¬ì„±ì…ë‹ˆë‹¤! ';
            if (failedExercises.length > 0) {
                goalsText += 'ì‹¤íŒ¨í•œ ìš´ë™ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ê°œì„ í•˜ì—¬ ê· í˜•ì¡íŒ ë°œì „ì„ ëª©í‘œë¡œ í•˜ì„¸ìš”.';
            } else {
                goalsText += 'í˜„ì¬ ìˆ˜ì¤€ì—ì„œ ê° ìš´ë™ë³„ë¡œ 5-10kgì”© ì ì§„ì ìœ¼ë¡œ ë„ì „í•´ë³´ì„¸ìš”.';
            }
            
            document.getElementById('feedbackGoals').textContent = goalsText;
        }

        function parseAndDisplayFeedback(feedback, recordData, result) {
            document.getElementById('aiFeedback').style.display = 'none';
            document.getElementById('feedbackSections').style.display = 'block';
            
            var sections = parseFeedbackSections(feedback);
            
            document.getElementById('feedbackSummary').textContent = 
                sections.summary || 'ì´ ' + result.total + 'kgìœ¼ë¡œ ' + result.rank + 'ìœ„ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!';
            
            document.getElementById('feedbackStrengths').textContent = 
                sections.strengths || 'í˜„ì¬ ìˆ˜ì¤€ì—ì„œ ì•ˆì •ì ì¸ ê¸°ë¡ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.';
            
            document.getElementById('feedbackImprovements').textContent = 
                sections.improvements || 'ê· í˜• ì¡íŒ ë°œì „ì„ ìœ„í•´ ê¾¸ì¤€í•œ í›ˆë ¨ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            
            document.getElementById('feedbackGoals').textContent = 
                sections.goals || 'ë‹¤ìŒ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ê¾¸ì¤€íˆ ë„ì „í•´ë³´ì„¸ìš”!';
        }

        function parseFeedbackSections(feedback) {
            var sections = {
                summary: '',
                strengths: '',
                improvements: '',
                goals: ''
            };
            
            try {
                // **ì„¹ì…˜ ì œëª©**ìœ¼ë¡œ êµ¬ë¶„ëœ ê²½ìš°
                if (feedback.includes('**ì´í‰**') || feedback.includes('**ê°•ì **')) {
                    var parts = feedback.split(/\*\*[^*]+\*\*/);
                    if (parts.length >= 5) {
                        sections.summary = parts[1].trim();
                        sections.strengths = parts[2].trim();
                        sections.improvements = parts[3].trim();
                        sections.goals = parts[4].trim();
                        return sections;
                    }
                }
                
                // ìˆ«ì êµ¬ë¶„ìë¡œ êµ¬ë¶„ëœ ê²½ìš° (1. 2. 3. 4.)
                if (feedback.includes('1.') && feedback.includes('2.')) {
                    var numberedParts = feedback.split(/\d+\.\s*/);
                    if (numberedParts.length >= 5) {
                        sections.summary = numberedParts[1].trim();
                        sections.strengths = numberedParts[2].trim();
                        sections.improvements = numberedParts[3].trim();
                        sections.goals = numberedParts[4].trim();
                        return sections;
                    }
                }
                
                // ë¬¸ì¥ìœ¼ë¡œ êµ¬ë¶„ (ê¸°ì¡´ ë°©ì‹ ê°œì„ )
                var sentences = feedback.split(/[.!?]\s+/).filter(function(s) { return s.trim().length > 0; });
                
                if (sentences.length >= 4) {
                    // ì²« ë²ˆì§¸ ë¬¸ì¥ë“¤ì„ ì´í‰ìœ¼ë¡œ
                    var summaryEnd = Math.ceil(sentences.length * 0.4);
                    sections.summary = sentences.slice(0, summaryEnd).join('. ') + '.';
                    
                    // ë‚˜ë¨¸ì§€ë¥¼ 3ë“±ë¶„
                    var remaining = sentences.slice(summaryEnd);
                    var thirdSize = Math.ceil(remaining.length / 3);
                    
                    sections.strengths = remaining.slice(0, thirdSize).join('. ') + '.';
                    sections.improvements = remaining.slice(thirdSize, thirdSize * 2).join('. ') + '.';
                    sections.goals = remaining.slice(thirdSize * 2).join('. ') + '.';
                } else if (sentences.length >= 2) {
                    sections.summary = sentences[0] + '.';
                    sections.improvements = sentences[1] + '.';
                    sections.strengths = 'í˜„ì¬ ìˆ˜ì¤€ì—ì„œ ì¢‹ì€ ê¸°ë¡ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.';
                    sections.goals = 'ê¾¸ì¤€í•œ í›ˆë ¨ìœ¼ë¡œ ë” ë†’ì€ ê¸°ë¡ì— ë„ì „í•´ë³´ì„¸ìš”!';
                } else {
                    // ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ì´í‰ìœ¼ë¡œ
                    sections.summary = feedback;
                    sections.strengths = 'ê¾¸ì¤€í•œ ë…¸ë ¥ì˜ ê²°ê³¼ì…ë‹ˆë‹¤.';
                    sections.improvements = 'ê· í˜• ì¡íŒ ë°œì „ì„ ìœ„í•´ ê³„ì† ë…¸ë ¥í•˜ì„¸ìš”.';
                    sections.goals = 'ë‹¤ìŒ ëª©í‘œë¥¼ í–¥í•´ ë„ì „í•´ë³´ì„¸ìš”!';
                }
                
                // ê° ì„¹ì…˜ì´ ë„ˆë¬´ ì§§ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
                if (sections.summary.length < 10) {
                    sections.summary = 'í›Œë¥­í•œ ê¸°ë¡ì…ë‹ˆë‹¤!';
                }
                if (sections.strengths.length < 10) {
                    sections.strengths = 'í˜„ì¬ ìˆ˜ì¤€ì—ì„œ ì¢‹ì€ ê¸°ë¡ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.';
                }
                if (sections.improvements.length < 10) {
                    sections.improvements = 'ê¾¸ì¤€í•œ í›ˆë ¨ìœ¼ë¡œ ë” ë°œì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                }
                if (sections.goals.length < 10) {
                    sections.goals = 'ë‹¤ìŒ ëª©í‘œë¥¼ í–¥í•´ ë„ì „í•´ë³´ì„¸ìš”!';
                }
                
            } catch (error) {
                console.error('í”¼ë“œë°± íŒŒì‹± ì˜¤ë¥˜:', error);
                sections.summary = 'í›Œë¥­í•œ ê¸°ë¡ì…ë‹ˆë‹¤!';
                sections.strengths = 'í˜„ì¬ ìˆ˜ì¤€ì—ì„œ ì¢‹ì€ ê¸°ë¡ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.';
                sections.improvements = 'ê¾¸ì¤€í•œ í›ˆë ¨ìœ¼ë¡œ ë” ë°œì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                sections.goals = 'ë‹¤ìŒ ëª©í‘œë¥¼ í–¥í•´ ë„ì „í•´ë³´ì„¸ìš”!';
            }
            
            return sections;
        }

        function shareResult() {
            var total = document.getElementById('resultTotal').textContent;
            var rank = document.getElementById('resultRank').textContent;
            var squatResult = document.getElementById('resultSquat').textContent;
            var benchResult = document.getElementById('resultBench').textContent;
            var deadResult = document.getElementById('resultDead').textContent;
            
            var shareText = 'ğŸ’ª 3ëŒ€ ìš´ë™ ê¸°ë¡ ì¸¡ì • ì™„ë£Œ!\n\n' +
                'ğŸ”¥ ì´í•©: ' + total + '\n' +
                'ğŸ“Š ' + rank + '\n\n' +
                'ğŸ¦µ ìŠ¤ì¿¼íŠ¸: ' + squatResult + '\n' +
                'ğŸ’ª ë²¤ì¹˜: ' + benchResult + '\n' +
                'ğŸ”¥ ë°ë“œ: ' + deadResult + '\n\n' +
                'ì»¤ë®¤ë‹ˆí‹°ë¡œ ì§„ì…: https://open.kakao.com/o/gQP8HyEh';
            
            if (navigator.share) {
                navigator.share({
                    title: 'ğŸ’ª 3ëŒ€ ìš´ë™ ê¸°ë¡',
                    text: shareText
                });
            } else {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareText).then(function() {
                        alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' + shareText);
                    }).catch(function() {
                        alert(shareText);
                    });
                } else {
                    alert(shareText);
                }
            }
        }

        function loadUserHistory() {
            console.log('=== íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹œì‘ ===');
            console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser);
            
            if (!currentUser || !currentUser.id) {
                console.log('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');
                document.getElementById('historyContent').innerHTML = 
                    '<div class="text-center" style="padding: 40px 0;">' +
                    '<h3 style="color: #ff4444;">âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>' +
                    '<p style="color: #ccc;">ê¸°ë¡ì„ í™•ì¸í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>' +
                    '</div>';
                return;
            }

            // ë¡œë”© í™”ë©´ í‘œì‹œ
            document.getElementById('historyContent').innerHTML = 
                '<div class="text-center" style="padding: 40px 0;">' +
                '<div class="loading"></div>' +
                '<div style="margin-top: 15px; color: #ccc;">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>' +
                '<div style="margin-top: 10px; font-size: 0.8rem; color: #666;">ì‚¬ìš©ì ID: ' + currentUser.id + '</div>' +
                '</div>';

            console.log('Google Apps Script ì—°ê²° í™•ì¸...');
            
            // Google Apps Script ì—°ê²° í™•ì¸
            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                console.error('âŒ Google Apps Script ì—°ê²° ì‹¤íŒ¨');
                showHistoryError('Google Apps Scriptê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì›¹ì•±ì´ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('âœ… Google Apps Script ì—°ê²° í™•ì¸ë¨');
            console.log('getUserRecords í˜¸ì¶œ ì‹œì‘, ì‚¬ìš©ì ID:', currentUser.id);

            // íƒ€ì„ì•„ì›ƒ ì„¤ì • (20ì´ˆ)
            var timeout = setTimeout(function() {
                console.error('â° ê¸°ë¡ ì¡°íšŒ íƒ€ì„ì•„ì›ƒ (20ì´ˆ ì´ˆê³¼)');
                showHistoryError('ì„œë²„ ì‘ë‹µì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }, 20000);

            // ë‹¨ê³„ë³„ ë””ë²„ê¹…ì„ ìœ„í•œ ì¶”ê°€ ì •ë³´
            console.log('ìš”ì²­ íŒŒë¼ë¯¸í„°:', {
                userId: currentUser.id,
                userIdType: typeof currentUser.id,
                userIdLength: String(currentUser.id).length
            });

            // ì‹¤ì œ ì„œë²„ í˜¸ì¶œ
            google.script.run
                .withSuccessHandler(function(result) {
                    clearTimeout(timeout);
                    console.log('âœ… ì„œë²„ ì‘ë‹µ ë°›ìŒ');
                    console.log('ì‘ë‹µ íƒ€ì…:', typeof result);
                    console.log('ì‘ë‹µ ë‚´ìš©:', result);
                    console.log('null ì²´í¬:', result === null);
                    console.log('undefined ì²´í¬:', result === undefined);
                    
                    // null ë˜ëŠ” undefined ì‘ë‹µ ì²˜ë¦¬
                    if (result === null || result === undefined) {
                        console.error('âŒ ì„œë²„ì—ì„œ null/undefined ì‘ë‹µ');
                        showHistoryError(
                            'ì„œë²„ì—ì„œ ì˜¬ë°”ë¥¸ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.<br>' +
                            '<strong>ì‘ë‹µê°’:</strong> ' + result + '<br>' +
                            '<strong>íƒ€ì…:</strong> ' + typeof result + '<br>' +
                            'ì›¹ì•± ë°°í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.'
                        );
                        return;
                    }
                    
                    // ì‘ë‹µ êµ¬ì¡° í™•ì¸
                    if (typeof result !== 'object') {
                        console.error('âŒ ì˜ëª»ëœ ì‘ë‹µ í˜•ì‹:', typeof result);
                        showHistoryError('ì„œë²„ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + typeof result);
                        return;
                    }
                    
                    // success ì†ì„± í™•ì¸
                    if (!result.hasOwnProperty('success')) {
                        console.error('âŒ success ì†ì„± ì—†ìŒ');
                        showHistoryError('ì„œë²„ ì‘ë‹µì— success ì†ì„±ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì‘ë‹µ: ' + JSON.stringify(result));
                        return;
                    }
                    
                    if (result.success) {
                        console.log('âœ… ê¸°ë¡ ì¡°íšŒ ì„±ê³µ');
                        console.log('ê¸°ë¡ ìˆ˜:', result.records ? result.records.length : 'records ì†ì„± ì—†ìŒ');
                        
                        if (!result.records) {
                            console.warn('âš ï¸ records ì†ì„±ì´ ì—†ìŒ, ë¹ˆ ë°°ì—´ë¡œ ì²˜ë¦¬');
                            result.records = [];
                        }
                        
                        displayHistory(result.records);
                    } else {
                        console.error('âŒ ê¸°ë¡ ì¡°íšŒ ì‹¤íŒ¨:', result.message);
                        showHistoryError('ê¸°ë¡ ì¡°íšŒ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                })
                .withFailureHandler(function(error) {
                    clearTimeout(timeout);
                    console.error('âŒ ì„œë²„ í˜¸ì¶œ ì‹¤íŒ¨:', error);
                    console.error('ì˜¤ë¥˜ íƒ€ì…:', typeof error);
                    console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                    console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                    
                    showHistoryError(
                        'ì„œë²„ í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>' +
                        '<strong>ì˜¤ë¥˜:</strong> ' + (error.message || error.toString()) + '<br>' +
                        '<strong>í•´ê²°ë°©ë²•:</strong><br>' +
                        '1. ì›¹ì•±ì„ ë‹¤ì‹œ ë°°í¬í•´ë³´ì„¸ìš”<br>' +
                        '2. ê¶Œí•œ ì„¤ì •ì„ í™•ì¸í•´ë³´ì„¸ìš”<br>' +
                        '3. Apps Script í¸ì§‘ê¸°ì—ì„œ í•¨ìˆ˜ë¥¼ ì§ì ‘ ì‹¤í–‰í•´ë³´ì„¸ìš”'
                    );
                })
                .getUserRecords(currentUser.id);
        }

        // ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜ ê°œì„ 
        function showHistoryError(message) {
            document.getElementById('historyContent').innerHTML = 
                '<div class="card" style="background-color: rgba(255,68,68,0.1); border: 1px solid #ff4444;">' +
                '<h3 style="color: #ff4444; text-align: center; margin-bottom: 15px;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h3>' +
                '<div style="color: #ccc; margin: 15px 0; line-height: 1.5;">' + message + '</div>' +
                '<div style="text-align: center; margin-top: 20px;">' +
                '<button class="btn" onclick="loadUserHistory()" style="margin-right: 10px;">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button>' +
                '<button class="btn btn-secondary" onclick="testConnection()">ğŸ”§ ì—°ê²° í…ŒìŠ¤íŠ¸</button>' +
                '</div>' +
                '</div>';
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì¶”ê°€
        function testConnection() {
            console.log('ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                alert('âŒ Google Apps Script ì—°ê²° ì‹¤íŒ¨\nì›¹ì•±ì´ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
            google.script.run
                .withSuccessHandler(function(result) {
                    console.log('í…ŒìŠ¤íŠ¸ ì‘ë‹µ:', result);
                    alert('âœ… ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!\nì‘ë‹µ: ' + JSON.stringify(result));
                })
                .withFailureHandler(function(error) {
                    console.error('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                    alert('âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\nì˜¤ë¥˜: ' + (error.message || error));
                })
                .testWebAppResponse(); // ìœ„ì—ì„œ ë§Œë“  í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
        }

        function displayHistory(records) {
            if (!records || records.length === 0) {
                document.getElementById('historyContent').innerHTML = 
                    '<div class="text-center" style="padding: 40px 0;">' +
                    '<div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“</div>' +
                    '<h3 style="color: #00ff88;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>' +
                    '<p style="color: #ccc; margin: 15px 0;">ì²« ë²ˆì§¸ ê¸°ë¡ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>' +
                    '<button class="btn" onclick="goToRecordType()" style="margin-top: 20px; width: auto; padding: 12px 25px;">ìƒˆ ê¸°ë¡ ë“±ë¡í•˜ê¸°</button>' +
                    '</div>';
                return;
            }

            var historyHTML = '';
            var maxTotal = Math.max.apply(Math, records.map(function(r) { return r.total || 0; }));
            
            for (var i = 0; i < records.length; i++) {
                var record = records[i];
                var date = new Date(record.timestamp);
                var dateStr = date.getFullYear() + 'ë…„ ' + 
                             (date.getMonth() + 1) + 'ì›” ' + 
                             date.getDate() + 'ì¼ ' +
                             date.getHours().toString().padStart(2, '0') + ':' +
                             date.getMinutes().toString().padStart(2, '0');
                
                var isPersonalBest = record.total === maxTotal && record.total > 0;
                
                historyHTML += 
                    '<div class="card" style="' + (isPersonalBest ? 'border: 2px solid #00ff88; background-color: rgba(0,255,136,0.05);' : '') + '">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">' +
                    '<div>' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<span style="color: #00ff88; font-weight: bold; font-size: 0.9rem;">' + record.recordType + '</span>' +
                    (isPersonalBest ? '<span style="background-color: #00ff88; color: #000; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold;">ê°œì¸ ìµœê³ </span>' : '') +
                    '</div>' +
                    '<div style="color: #ccc; font-size: 0.8rem; margin-top: 3px;">' + dateStr + '</div>' +
                    '</div>' +
                    '<div style="text-align: right;">' +
                    '<div style="font-size: 1.4rem; font-weight: bold; color: ' + (isPersonalBest ? '#00ff88' : '#ff4444') + ';">' + record.total + 'kg</div>' +
                    '<div style="font-size: 0.8rem; color: #ccc;">' + record.rank + 'ìœ„</div>' +
                    '</div>' +
                    '</div>' +
                    '<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">' +
                    '<div style="text-align: center; padding: 12px 8px; background-color: rgba(0,0,0,0.4); border-radius: 6px;">' +
                    '<div style="color: #ccc; font-size: 0.7rem; margin-bottom: 4px;">ğŸ¦µ ìŠ¤ì¿¼íŠ¸</div>' +
                    '<div style="font-weight: bold; font-size: 0.9rem; color: ' + (record.squatSuccess === 'ì„±ê³µ' ? '#00ff88' : '#ff4444') + ';">' +
                    (record.squatSuccess === 'ì„±ê³µ' ? record.squatWeight + 'kg' : 'ì‹¤íŒ¨') +
                    '</div>' +
                    '</div>' +
                    '<div style="text-align: center; padding: 12px 8px; background-color: rgba(0,0,0,0.4); border-radius: 6px;">' +
                    '<div style="color: #ccc; font-size: 0.7rem; margin-bottom: 4px;">ğŸ’ª ë²¤ì¹˜</div>' +
                    '<div style="font-weight: bold; font-size: 0.9rem; color: ' + (record.benchSuccess === 'ì„±ê³µ' ? '#00ff88' : '#ff4444') + ';">' +
                    (record.benchSuccess === 'ì„±ê³µ' ? record.benchWeight + 'kg' : 'ì‹¤íŒ¨') +
                    '</div>' +
                    '</div>' +
                    '<div style="text-align: center; padding: 12px 8px; background-color: rgba(0,0,0,0.4); border-radius: 6px;">' +
                    '<div style="color: #ccc; font-size: 0.7rem; margin-bottom: 4px;">ğŸ”¥ ë°ë“œ</div>' +
                    '<div style="font-weight: bold; font-size: 0.9rem; color: ' + (record.deadSuccess === 'ì„±ê³µ' ? '#00ff88' : '#ff4444') + ';">' +
                    (record.deadSuccess === 'ì„±ê³µ' ? record.deadWeight + 'kg' : 'ì‹¤íŒ¨') +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            }

            var totalRecords = records.length;
            var avgTotal = Math.round(records.reduce(function(sum, r) { return sum + (r.total || 0); }, 0) / totalRecords);
            
            var summaryHTML = 
                '<div class="card" style="background-color: rgba(0,255,136,0.1); border: 1px solid #00ff88; margin-bottom: 20px;">' +
                '<h3 style="color: #00ff88; text-align: center; margin-bottom: 15px;">ğŸ“Š ë‚˜ì˜ ìš´ë™ ê¸°ë¡ ìš”ì•½</h3>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">' +
                '<div>' +
                '<div style="color: #ccc; font-size: 0.8rem;">ì´ ìš´ë™ íšŸìˆ˜</div>' +
                '<div style="font-size: 1.5rem; font-weight: bold; color: #00ff88;">' + totalRecords + '</div>' +
                '<div style="color: #ccc; font-size: 0.7rem;">íšŒ</div>' +
                '</div>' +
                '<div>' +
                '<div style="color: #ccc; font-size: 0.8rem;">ê°œì¸ ìµœê³ </div>' +
                '<div style="font-size: 1.5rem; font-weight: bold; color: #ff4444;">' + maxTotal + '</div>' +
                '<div style="color: #ccc; font-size: 0.7rem;">kg</div>' +
                '</div>' +
                '<div>' +
                '<div style="color: #ccc; font-size: 0.8rem;">í‰ê·  ê¸°ë¡</div>' +
                '<div style="font-size: 1.5rem; font-weight: bold; color: #ff8800;">' + avgTotal + '</div>' +
                '<div style="color: #ccc; font-size: 0.7rem;">kg</div>' +
                '</div>' +
                '</div>' +
                '</div>';

            document.getElementById('historyContent').innerHTML = summaryHTML + historyHTML;
        }

        // ìˆœìœ„ í™”ë©´ìœ¼ë¡œ ì´ë™
        function goToRankings() {
            showScreen('rankingsScreen');
            loadRankings();
        }

        // ìˆœìœ„ ë°ì´í„° ë¡œë“œ (ê°œì„ ëœ ë””ë²„ê¹… ë²„ì „)
        function loadRankings() {
            console.log('=== í´ë¼ì´ì–¸íŠ¸: ìˆœìœ„ ë¡œë”© ì‹œì‘ ===');
            console.log('í˜„ì¬ ì‹œê°„:', new Date().toISOString());
            console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser);
            
            // ë¡œë”© í™”ë©´ í‘œì‹œ
            document.getElementById('rankingsContent').innerHTML = 
                '<div class="text-center" style="padding: 40px 0;">' +
                '<div class="loading"></div>' +
                '<div style="margin-top: 15px; color: #ccc;">ìˆœìœ„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>' +
                '<div style="margin-top: 10px; font-size: 0.8rem; color: #666;">ë””ë²„ê¹… ëª¨ë“œ í™œì„±í™”</div>' +
                '</div>';

            // Google Apps Script ì—°ê²° í™•ì¸
            console.log('Google Apps Script í™•ì¸...');
            console.log('typeof google:', typeof google);
            console.log('google.script:', google ? google.script : 'google is undefined');
            console.log('google.script.run:', google && google.script ? google.script.run : 'google.script is undefined');

            if (typeof google === 'undefined' || !google.script || !google.script.run) {
                console.error('âŒ Google Apps Script ì—°ê²° ì‹¤íŒ¨');
                showRankingsError('Google Apps Script ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            console.log('âœ… Google Apps Script ì—°ê²° í™•ì¸ë¨');
            
            // íƒ€ì„ì•„ì›ƒ ì„¤ì •
            const timeout = setTimeout(function() {
                console.error('â° ìˆœìœ„ ì¡°íšŒ íƒ€ì„ì•„ì›ƒ (20ì´ˆ ì´ˆê³¼)');
                showRankingsError('ì„œë²„ ì‘ë‹µì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }, 20000);

            // ì„œë²„ í˜¸ì¶œ
            console.log('getAllRankings í˜¸ì¶œ ì‹œì‘...');
            
            google.script.run
                .withSuccessHandler(function(result) {
                    clearTimeout(timeout);
                    console.log('âœ… ì„œë²„ ì‘ë‹µ ë°›ìŒ');
                    console.log('ì‘ë‹µ íƒ€ì…:', typeof result);
                    console.log('ì‘ë‹µ ë‚´ìš©:', result);
                    
                    // null/undefined ì²´í¬
                    if (result === null || result === undefined) {
                        console.error('âŒ null/undefined ì‘ë‹µ');
                        showRankingsError('ì„œë²„ì—ì„œ ì˜¬ë°”ë¥¸ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    // success ì²´í¬
                    if (!result.hasOwnProperty('success')) {
                        console.error('âŒ success ì†ì„± ì—†ìŒ');
                        showRankingsError('ì„œë²„ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (result.success) {
                        console.log('âœ… ìˆœìœ„ ì¡°íšŒ ì„±ê³µ');
                        console.log('ìˆœìœ„ ë°ì´í„° ìˆ˜:', result.rankings ? result.rankings.length : 0);
                        
                        // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                        allRankings = result.rankings || [];
                        console.log('ì „ì—­ ë³€ìˆ˜ allRankings:', allRankings);
                        
                        // í™”ë©´ì— í‘œì‹œ
                        displayRankings();
                        updateMyRank();
                        updateStats();
                    } else {
                        console.error('âŒ ìˆœìœ„ ì¡°íšŒ ì‹¤íŒ¨:', result.message);
                        showRankingsError('ìˆœìœ„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ' + (result.message || ''));
                    }
                })
                .withFailureHandler(function(error) {
                    clearTimeout(timeout);
                    console.error('âŒ ì„œë²„ í˜¸ì¶œ ì‹¤íŒ¨');
                    console.error('ì˜¤ë¥˜ íƒ€ì…:', typeof error);
                    console.error('ì˜¤ë¥˜ ë‚´ìš©:', error);
                    console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                    console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                    
                    showRankingsError('ìˆœìœ„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error.toString()));
                })
                .getAllRankings();
            
            console.log('getAllRankings í˜¸ì¶œ ì™„ë£Œ (ì‘ë‹µ ëŒ€ê¸°ì¤‘)');
        }

        // ìˆœìœ„ í‘œì‹œ (ë””ë²„ê¹… ì¶”ê°€)
        function displayRankings() {
            console.log('=== displayRankings ì‹œì‘ ===');
            console.log('allRankings:', allRankings);
            console.log('currentFilter:', currentFilter);
            
            applyFilter();
            
            console.log('filteredRankings:', filteredRankings);
            console.log('filteredRankings ê¸¸ì´:', filteredRankings.length);
            
            if (filteredRankings.length === 0) {
                console.log('âš ï¸ í‘œì‹œí•  ìˆœìœ„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                document.getElementById('rankingsContent').innerHTML = 
                    '<div class="text-center" style="padding: 40px 0;">' +
                    '<div style="font-size: 3rem; margin-bottom: 20px;">ğŸ†</div>' +
                    '<h3 style="color: #ccc;">ìˆœìœ„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>' +
                    '<p style="color: #666;">í•„í„°: ' + currentFilter + '</p>' +
                    '<p style="color: #666;">ì „ì²´ ë°ì´í„° ìˆ˜: ' + (allRankings ? allRankings.length : 0) + '</p>' +
                    '</div>';
                return;
            }

            console.log('ìˆœìœ„ HTML ìƒì„± ì¤‘...');
            var html = '';
            for (var i = 0; i < filteredRankings.length; i++) {
                var ranking = filteredRankings[i];
                console.log(`ìˆœìœ„ ${i + 1}:`, ranking);
                
                var rankClass = getRankClass(ranking.rank);
                var isCurrentUser = currentUser && ranking.userId === currentUser.id;
                
                html += 
                    '<div class="rank-item" style="' + (isCurrentUser ? 'border: 2px solid #00ff88; background-color: rgba(0,255,136,0.1);' : '') + '">' +
                    '<div class="rank-number ' + rankClass + '">' + getRankDisplay(ranking.rank) + '</div>' +
                    '<div class="user-info">' +
                    '<div class="user-name" style="' + (isCurrentUser ? 'color: #00ff88;' : '') + '">' +
                    ranking.name + (isCurrentUser ? ' (ë‚˜)' : '') +
                    '</div>' +
                    '<div class="user-details">' +
                    ranking.gender + ' | ' + ranking.trainer + ' íŠ¸ë ˆì´ë„ˆ' +
                    '</div>' +
                    '</div>' +
                    '<div class="user-total">' + ranking.total + 'kg</div>' +
                    '</div>';
            }
            
            console.log('ìˆœìœ„ HTML ìƒì„± ì™„ë£Œ, ê¸¸ì´:', html.length);
            document.getElementById('rankingsContent').innerHTML = html;
            console.log('âœ… ìˆœìœ„ í‘œì‹œ ì™„ë£Œ');
        }

        // ìˆœìœ„ë³„ í´ë˜ìŠ¤ ë°˜í™˜
        function getRankClass(rank) {
            if (rank === 1) return 'rank-gold';
            if (rank === 2) return 'rank-silver';
            if (rank === 3) return 'rank-bronze';
            return 'rank-normal';
        }

        // ìˆœìœ„ í‘œì‹œ í˜•ì‹
        function getRankDisplay(rank) {
            if (rank === 1) return 'ğŸ¥‡';
            if (rank === 2) return 'ğŸ¥ˆ';
            if (rank === 3) return 'ğŸ¥‰';
            return rank;
        }

        // í•„í„° ì ìš©
        function filterRankings(filter) {
          currentFilter = filter;
          // íƒ­ í™œì„±í™”
          var tabs = document.querySelectorAll('.filter-tab');
          for (var i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove('active');
        
           // í˜„ì¬ í•„í„°ì™€ ì¼ì¹˜í•˜ëŠ” íƒ­ í™œì„±í™”
            if ((filter === 'all' && tabs[i].textContent.includes('ì „ì²´')) ||
              (filter === 'male' && tabs[i].textContent.includes('ë‚¨ì„±')) ||
              (filter === 'female' && tabs[i].textContent.includes('ì—¬ì„±'))) {
            tabs[i].classList.add('active');
        }
    }
    
    displayRankings();
}


        // í•„í„° ë¡œì§
        function applyFilter() {
            if (currentFilter === 'all') {
                filteredRankings = allRankings.slice();
            } else if (currentFilter === 'male') {
                filteredRankings = allRankings.filter(function(r) { return r.gender === 'ë‚¨'; });
            } else if (currentFilter === 'female') {
                filteredRankings = allRankings.filter(function(r) { return r.gender === 'ì—¬'; });
            }
            
            // ê²€ìƒ‰ì–´ ì ìš©
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredRankings = filteredRankings.filter(function(r) {
                    return r.name.toLowerCase().includes(searchTerm);
                });
            }
        }

        // ê²€ìƒ‰
        function searchRankings() {
            displayRankings();
        }

        // ë‚´ ìˆœìœ„ ì—…ë°ì´íŠ¸
        function updateMyRank() {
            if (!currentUser) return;
            
            var myRank = allRankings.find(function(r) { return r.userId === currentUser.id; });
            
            if (myRank) {
                document.getElementById('myCurrentRank').textContent = myRank.rank + 'ìœ„';
                document.getElementById('myBestTotal').textContent = myRank.total + 'kg';
                document.getElementById('myRankCard').style.display = 'block';
            } else {
                document.getElementById('myRankCard').style.display = 'none';
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            var totalUsers = allRankings.length;
            var avgTotal = totalUsers > 0 ? 
                Math.round(allRankings.reduce(function(sum, r) { return sum + r.total; }, 0) / totalUsers) : 0;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('avgTotal').textContent = avgTotal + 'kg';
        }

        // ì˜¤ë¥˜ í‘œì‹œ
        function showRankingsError(message) {
            document.getElementById('rankingsContent').innerHTML = 
                '<div class="text-center" style="padding: 40px 0; color: #ff4444;">' +
                '<div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>' +
                '<h3>ì˜¤ë¥˜ ë°œìƒ</h3>' +
                '<p style="color: #ccc; margin: 15px 0;">' + message + '</p>' +
                '<button class="btn" onclick="loadRankings()" style="width: auto; padding: 12px 25px;">ë‹¤ì‹œ ì‹œë„</button>' +
                '</div>';
        }

        // ===== ë””ë²„ê¹… í—¬í¼ í•¨ìˆ˜ë“¤ =====
        window.debugRankings = function() {
            console.log('=== ë””ë²„ê¹… ì •ë³´ ===');
            console.log('allRankings:', allRankings);
            console.log('filteredRankings:', filteredRankings);
            console.log('currentFilter:', currentFilter);
            console.log('currentUser:', currentUser);
            console.log('rankingsContent HTML:', document.getElementById('rankingsContent').innerHTML);
        };

        // í…ŒìŠ¤íŠ¸ìš© í•¨ìˆ˜
        window.setTestRankings = function() {
            console.log('í…ŒìŠ¤íŠ¸ ìˆœìœ„ ë°ì´í„° ì„¤ì •...');
            allRankings = [
                { userId: 'TEST_001', name: 'í…ŒìŠ¤íŠ¸1', gender: 'ë‚¨', trainer: 'ê¹€ì½”ì¹˜', total: 500, rank: 1 },
                { userId: 'TEST_002', name: 'í…ŒìŠ¤íŠ¸2', gender: 'ì—¬', trainer: 'ì´ì½”ì¹˜', total: 450, rank: 2 },
                { userId: 'TEST_003', name: 'í…ŒìŠ¤íŠ¸3', gender: 'ë‚¨', trainer: 'ë°•ì½”ì¹˜', total: 400, rank: 3 }
            ];
            displayRankings();
            updateStats();
            console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì • ì™„ë£Œ');
        };

        // ì „ì²´ ìˆœìœ„ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        window.testRankingsFlow = function() {
            console.log('=== ì „ì²´ ìˆœìœ„ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            // 1. ì „ì—­ ë³€ìˆ˜ í™•ì¸
            console.log('1. ì „ì—­ ë³€ìˆ˜ í™•ì¸');
            console.log('  - allRankings:', allRankings);
            console.log('  - filteredRankings:', filteredRankings);
            console.log('  - currentFilter:', currentFilter);
            console.log('  - currentUser:', currentUser);
            
            // 2. DOM ìš”ì†Œ í™•ì¸
            console.log('2. DOM ìš”ì†Œ í™•ì¸');
            console.log('  - rankingsContent:', document.getElementById('rankingsContent'));
            console.log('  - myRankCard:', document.getElementById('myRankCard'));
            console.log('  - totalUsers:', document.getElementById('totalUsers'));
            console.log('  - avgTotal:', document.getElementById('avgTotal'));
            
            // 3. í•„í„° íƒ­ í™•ì¸
            console.log('3. í•„í„° íƒ­ í™•ì¸');
            const filterTabs = document.querySelectorAll('.filter-tab');
            console.log('  - í•„í„° íƒ­ ìˆ˜:', filterTabs.length);
            filterTabs.forEach((tab, index) => {
                console.log(`  - íƒ­ ${index}:`, tab.textContent, tab.className);
            });
            
            // 4. ê²€ìƒ‰ ì…ë ¥ í™•ì¸
            console.log('4. ê²€ìƒ‰ ì…ë ¥ í™•ì¸');
            const searchInput = document.getElementById('searchInput');
            console.log('  - searchInput:', searchInput);
            console.log('  - searchInput value:', searchInput ? searchInput.value : 'null');
        };
    </script>
</body>
</html>
